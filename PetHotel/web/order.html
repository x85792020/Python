<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="/eel.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/af7b1c5259.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/function.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <style>

    </style>
</head>
<body>
    <!--上方標題瀏覽選單-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">寵物旅館訂單系統</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarColor02">
            <ul class="navbar-nav me-auto">
                <li class="nav-item active">
                <a class="nav-link" href="order.html"><i class="far fa-copy"></i> 訂單資料
                    <span class="visually-hidden">(current)</span>
                </a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="owner.html"><i class="fas fa-handshake"></i> 客戶資訊</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="pets.html"><i class="fas fa-cat"></i> 寵物資料</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="rooms.html"><i class="fas fa-home"></i> 房間資訊</a>
                </li>
                <a class="nav-link" href="hospital.html"><i class="fas fa-ambulance"></i> 醫院名單</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="employees.html"><i class="fas fa-user-friends"></i> 員工資料</a>
                </li>
            </ul>
            </div>
        </div>
    </nav>
    <!--上方標題瀏覽選單-->

    <div class="container-fluid my-3" >
        <div class="row">
            <div class="col-6">
                <div class="info-block px-2 py-2">
                    <div class="row">
                        <div class="col-12">
                            <h4><i class="far fa-copy"></i> 訂單資料</h2>
                        </div>
                        <div class="col-8">
                            寵物名稱: (搜尋條件請依照,分開)
                            <input type="text" id="search-petName" class="form-control">
                        </div>
                        <div class="col-2">
                            搜尋方式: 
                            <!--在這!!!!!  IN & NOT IN-->
                            <select id="search-mode" class="form-control">
                                <option value="IN">IN</option>
                                <option value="NOT IN">NOT IN</option>
                                <option value="EXISTS">EXISTS</option>
                                <option value="NOT EXISTS">NOT EXISTS</option>
                            </select>
                        </div>
                        <div class="col-2">
                            <br>
                            <span class="btn btn-primary" id="search-btn">搜尋</span>
                        </div>
                        <div class="col-12">
                            <div id="order-info">

                            </div>
                        </div>
                    </div>

                </div>

            </div>
            <div class="col-6">
                <form id="order-form">
                    <div class="row">
                        <div class="col-12">
                            <h4><i class="far fa-copy"></i><span id="function-header">新增訂單</span></h2>
                        </div>
                        <div class="col-12">
                            <label target="order_id">訂單編號</label>
                            <input type="text" id="order_id" class="form-control" readonly="readonly">
                            <span class="error-msg" style="color:red;" error-msg="order_id"></span>
                        </div>
                        <div class="col-6">
                            <label target="pet_id">寵物名稱</label>
                            <select id="pet_id" class="form-control"></select>
                            <span class="error-msg" style="color:red;" error-msg="pet_id"></span>
                        </div>
                        <div class="col-6">
                            <label target="room_id">房間名稱</label>
                            <select id="room_id" class="form-control"></select>
                            <span class="error-msg" style="color:red;" error-msg="room_id"></span>
                        </div>
                        <div class="col-6">
                            <label target="employee_id">負責員工</label>
                            <select id="employee_id" class="form-control"></select>
                            <span class="error-msg" style="color:red;" error-msg="employee_id"></span>
                        </div>
                        <div class="col-6">
                            <label target="date">日期</label>
                            <input type="date" id="date" class="form-control">
                            <span class="error-msg" style="color:red;" error-msg="date"></span>
                        </div>
                        <div class="col-12">
                            <label target="price">入住金額</label>
                            <input type="number" id="price" class="form-control">
                            <span class="error-msg" style="color:red;" error-msg="price"></span>
                        </div>
                        <div class="col-12 py-3">
                            <p style="text-align: right;">
                                <span class="btn btn-primary add-btn" >新增</span>
                                <span class="btn btn-primary cancel-btn" style="display: none;">取消</span>
                            </p>

                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <div class="blackboard px-4 py-4">
                <div class="row">
                    <div class="col-12">
                        <p><b>訂單數量大於三筆以上的員工(<input id="searchYear" type="number" style="width: 80px;"/>/<input id="searchMonth"  style="width: 50px;" type="number"/>月)</b> <span class="btn btn-primary group-btn" >統計</span></p>
                        <div id = "rank-block">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="blackboard px-4 py-4">
                <div class="row">
                    <div class="col-12">
                        <p><b>細節查詢</b> <span class="btn btn-primary detailSearch-btn">查詢</span></p>
                        <p>
                            <select id="caculateOption" class="form-control">
                                <option value="COUNT">(Count)目前訂單總數</option>
                                <option value="SUM">(Sum)目前訂單總入住金額</option>
                                <option value="AVG">(Average)平均訂單入住金額</option>
                                <option value="MAX">(Max)訂單最高入住金額</option>
                                <option value="MIN">(Min)訂單最低入住金額</option>
                            </select>
                            
                        </p>
                    </div>
                    <div class="col-12"  id="detail-search">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="col-12">
            SQL指令區域
        </div>  
        <div class="col-12">
            <textarea id="sql-input" class="w-100" rows="5"></textarea>
        </div>
        <div class="col-12 py-3">
            <p style="text-align: right;">
                <button class="btn btn-primary" id="clear-sql">清空</button>
                <button class="btn btn-primary" id="run-sql">執行</button>
            </p>
        </div>
        <div class="col-12">
            <p>SQL 指令輸出區域</p>
        </div>  
        <div class="row">
            <div class="col-12 py-3">
                <div id="output-block" style="min-height:20vh;border:1px solid rgba(0,0,0,0.25);">
                    請輸入指令......
                </div>
            </div>
        </div>
    </div>


    
    <script>
        //畫面準備完成後會執行的FUNCTION
        $(function(){
            //取得訂單資料
            getAllOrderData();
            //新增模式初始化
            createModelInit();
            //
            var dateT = new Date();
            var year = dateT.getFullYear();
            var month = dateT.getMonth()+1;
            $('#searchYear').val(year);
            $('#searchMonth').val(month);
            getOraderMonthRank(year,month,1);
        });

        //按下統計GROUP BY
        $('.group-btn').click(function(){
            var year = $('#searchYear').val();
            var month = $('#searchMonth').val();
            
            getOraderMonthRank(year,month,1);
        });

        
        //編輯按鈕綁定
        $("#order-info").on('click', ".edit-btn", function(){
            $('#function-header').text('編輯訂單');
            $('.add-btn').text('確定');
            $('.cancel-btn').show();
            //只會有一個變成藍色所以先清掉所有
            $('#order-info tr').removeClass('nowEdit');
            //再加入要變色的目標
            $(this).parents('tr').addClass('nowEdit');
            //取得點選的ORDER 相關資料帶到畫面上
            var order_id = $(this).attr('target-id');
            getOrderData(order_id);
            
        });
        //編輯按鈕綁定
        $("#order-info").on('click', ".del-btn", function(){
            var order_id = $(this).attr('target-id');
            var r=confirm("按下確定後將無法恢復,確定要刪除嗎?")
            if (r==true)
                {
                    delOrder(order_id);
                }
            else
                {
                }
            
        });
        $('.add-btn').click(function(){
            //清空錯誤訊息
            $('.error-msg').text('');
            //進行新增或編輯作業
            //submitOrderData(orderData);
            var checkFlag = true;
            var allinput = $('#order-form input:not(#order_id)');
            var allselect = $('#order-form select');
            for(var i = 0 ;i < allinput.length; i++){
                var inputVal =allinput[i].value;
                var inputId = allinput[i].id;
                if(inputVal == ""){
                    var title = $('label[target="'+inputId+'"]').text();
                    $('[error-msg="'+inputId+'"]').text('請輸入'+title);
                    checkFlag = false;
                }
            }
            for(var i = 0 ;i < allselect.length; i++){
                var selectVal =allselect[i].value;
                var selectId = allselect[i].id;
                if(selectVal == "請選擇"){
                    var title = $('label[target="'+selectId+'"]').text();
                    $('[error-msg="'+selectId+'"]').text('請選擇'+title);
                    checkFlag = false;
                }
            } 
            if(checkFlag){
                var dateFormat = $('#date').val();
                dateFormat = dateFormat.replace('/','-');
                var orderData = {
                order_id:$('#order_id').val(),
                pet_id:$('#pet_id').val(),
                room_id:$('#room_id').val(),
                employee_id:$('#employee_id').val(),
                date:dateFormat,
                price:$('#price').val(),
                };
                submitOrderData(orderData);
                var year = $('#searchYear').val();
                var month = $('#searchMonth').val();
                getOraderMonthRank(year,month,1);
            }
            

        });
        $('.cancel-btn').click(function(){
            $('#order-info tr').removeClass('nowEdit');
            $(this).hide();
            $('.add-btn').text('新增');
            $('#function-header').text('新增訂單');
            //清空錯誤訊息
            $('.error-msg').text('');
            //清空選項
            createModelInit();
        });
        
        //搜尋按鈕事件綁定
        $('#search-btn').click(function(){
            var searchCondition = $('#search-petName').val();
            var mode = $('#search-mode').val();
            if(searchCondition != ""){
                getAllOrderData(searchCondition,mode);
            }else{
                getAllOrderData();
            } 
        });
        function createModelInit(){
            //選取內容清空
            $('#order_id').val('');
            $('#date').val('');
            getPetOption();
            getEmployeeOption();
            getRoomOption();
        }


        // id="run-clear" 的html 標籤
        $('#run-sql').click(function(){ 
            //點擊之後 觸發的事件
            //取得目前所得到的範例:
            var sql = $('#sql-input').val();
            if(sql != ""){
                runSQL(sql);
            }
        });
        $('#clear-sql').click(function(){
            $('#output-block').text('....');
        });
        $('.detailSearch-btn').click(function(){
            var selectOption = $('#caculateOption').val();
            getCalculate(selectOption);
        });
    </script>
</body>
</html>